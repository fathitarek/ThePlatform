@extends('home.layouts.app')@section('pageTitle')    <title>{{ Lang::get('home.home_page_title') }}</title>    @endsection@section('contentHeader')    <ul class="breadcrumb">        <li class="breadcrumb-item"><a href="{{ URL('publisher') }}">{{ Lang::get('home.publisher') }}</a></li>    </ul>@endsection        @section('leftSideMenu')            <div class="desktop-menu menu-side-compact-w menu-activated-on-hover color-scheme-dark">                <div class="logo-w">                    <a class="logo" href="{{ URL('') }}">                        <img src="{{ asset('img/logo.png') }}">                    </a>                </div>                <div class="menu-and-user">                    <ul class="main-menu">                        <li>                            <a class="mr-2 btn btn-primary" id="leftMenuCreatePost" data-target="@if(count($userProfiles)) .bd-chose-page @else .bd-create-new-post-lg @endif" data-toggle="modal">                                <div class="icon-w" data-toggle="tooltip" data-placement="top" data-original-title="{{ Lang::get('home.create_new_post') }}">                                    <div class="fa fa-plus">                                    </div>                                </div>                            </a>                        </li>                        <li class="@if(Request::path()=='/') active @endif">                            <a href="{{ URL('/') }}">                                <div class="icon-w" data-toggle="tooltip" data-placement="top" data-original-title="{{ Lang::get('home.dashboard') }}">                                    <div class="os-icon os-icon-window-content">                                    </div>                                </div>                            </a>                        </li>                        <li>                            <a href="{{ URL('/termsAndConditions') }}">                                <div class="icon-w" data-toggle="tooltip" data-placement="top" data-original-title="{{ Lang::get('home.terms_and_conditions') }}">                                    <div class="fa fa-question-circle"></div>                                </div>                            </a>                        </li>                        <li>                            <a href="{{ URL('/support') }}">                                <div class="icon-w" data-toggle="tooltip" data-placement="top" data-original-title="{{ Lang::get('home.support') }}">                                    <div class="fa fa-life-ring">                                    </div>                                </div>                            </a>                        </li>                        <li>                            <a href="{{ URL('/privacy') }}">                                <div class="icon-w" data-toggle="tooltip" data-placement="top" data-original-title="{{ Lang::get('home.privacy') }}">                                    <div class="fa fa-user-secret">                                    </div>                                </div>                            </a>                        </li>                    </ul>                </div>            </div>        @endsection    @section('content')        <div aria-hidden="true" aria-labelledby="mySmallModalLabel" class="modal fade bd-chose-page" role="dialog" tabindex="-1">            <div class="modal-dialog modal-sm">                <div class="modal-content">                    <div class="modal-header">                        <h5 class="modal-title" id="exampleModalLabel">Select Profiles</h5>                        <button aria-label="Close" class="close" data-dismiss="modal" type="button">                            <span aria-hidden="true"> Ã—</span>                        </button>                    </div>                    <div class="modal-body">                        <div class="row">                            <div class="form-group col-lg-12">                                <input type="text" class="form-control" id="searchProfile">                            </div>                            <div class="form-group col-lg-12">                                <div class="checkbox">                                    <label>                                        <input type="checkbox" id="checkAllProfiles">                                        Select all Profiles                                    </label>                                </div>                            </div>                            <div class="clearfix"></div>                            <div id="allProfiles">                                @foreach($userProfiles as $profile)                                    <div class="col-lg-12"><div class="checkbox"><label><input type="checkbox" class="userProfiles" data-name="{{ $profile->page_name }}" value="{{ $profile->page_id }}" id=""><img src="{{ $profile->page_image_url }}" alt="{{ $profile->page_name }}"><span>{{ $profile->page_name }}</span></label></div></div>                                @endforeach                            </div>                        </div>                    </div>                    <div class="modal-footer">                        <button class="btn btn-secondary" data-dismiss="modal" type="button"> Close</button>                        <button  class="btn btn-primary" id="useProfile" type="button">Use Selected Profiles</button>                    </div>                </div>            </div>        </div>    <!-- END PAGE TITLE-->    <!-- END PAGE HEADER-->    <!-- BEGIN DASHBOARD STATS 1-->    <div class="blog-page blog-content-1">        <div class="clearfix"></div>        <div class="clearfix" style="height:20px"></div>        <div class="clearfix"></div>        <div class="col-lg-7 col-md-7 col-sm-12 col-xs-12">            <div id="errorMessage"></div>            <div id="postsInPages">                {{--<div class="col-lg-12 postToPage" data-id="131752234107545"><img src="https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/20799907_131752677440834_5496398408492918250_n.jpg?oh=c4c9047b010223a4aa074cbe048d134d&amp;oe=5A3F36EC" alt="Test_page"><span>Test_page</span><a href="" onclick="return false;" date-time="now"  class="pull-right schedule">Now</a></div>--}}            </div>            <div class="clearfix"></div>            <div class="clearfix" style="height: 50px;"></div>            <div class="panel panel-default">                <div class="panel-body">                    <textarea class="form-control" name="postMessage" id="postMessage" placeholder="Post Content" rows="5" style="height: 50px; overflow: hidden; word-wrap: break-word;border: none;resize: none;" data-autosize-on="true"></textarea>                </div>                <div class="panel-footer post-footer">                    <div class="post-icon pull-left">                        <a href="#">                            <i class="fa fa-camera"></i>                        </a>                        <a href="#">                            <i class="fa fa-tags"></i>                        </a>                        <a href="#">                            <i class="fa fa-calendar"></i>                        </a>                    </div>                    <div class="pull-right">                        <span id="countPost">0</span>                    </div>                    <div class="clearfix"></div>                </div>            </div>            <div>                <div class="pull-right">                    <a href="#" id="clearPublisher">Clear Publisher</a>                    <button disabled="disabled" id="postButton" class="btn btn-primary">Schedule</button>                </div>            </div>        </div>        <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">            <h4>Post Preview</h4>            <p>Please select a profile to preview</p>            <p>Available only for Facebook and Twitter pages</p>            <style>                #preview #facebookPost .comment:before{                    content: "";                    background-position: -271px -142px;                    background-repeat: no-repeat;                    overflow: hidden;                    width: 15px;                    height: 15px;                    background-image: url('{{ asset('img/sprite-icons.png') }}');                    display: inline-block;                    position: relative;                    top: 3px;                    margin-right: 5px;                }                #preview #facebookPost .like:before{                     content: "";                     background-position: -271px -112px;                     background-repeat: no-repeat;                     overflow: hidden;                     width: 15px;                     height: 15px;                     background-image: url('{{ asset('img/sprite-icons.png') }}');                     display: inline-block;                     position: relative;                     top: 3px;                     margin-right: 6px;                 }                #preview #facebookPost .share:before{                    content: "";                    background-position: -271px -127px;                    background-repeat: no-repeat;                    overflow: hidden;                    width: 15px;                    height: 15px;                    background-image: url('{{ asset('img/sprite-icons.png') }}');                    display: inline-block;                    position: relative;                    top: 3px;                    margin-right: 6px;                }                #facebookPost{                    padding: 12px 12px 6px;border: 1px solid #dee0ea;background-color: #fff;                }                #facebookPost img{                    position: absolute;                }                #facebookPost .title{                    margin-left: 60px;color: #415496;font-size: 14px;font-weight: 700;font-family: Arial,sans-serif;                }                #facebookPost .datetime{                    margin-left: 60px;color: #899ab3;font-size: 12px;                }                #emptyPost{                    width: 352px;height: 231px;background:url('{{ URL('img/post-preview-empty.svg') }}');                }                .hasAddPage *{                    cursor: not-allowed;                }            </style>            <div id="preview">                <div id="emptyPost"></div>                <div id="facebookPost" class="hidden">                    <img src="https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/20799907_131752677440834_5496398408492918250_n.jpg?oh=c4c9047b010223a4aa074cbe048d134d&oe=5A3F36EC" alt="">                    <div class="title">Test_page</div>                    <div class="datetime">Just Now - <i class="fa fa-globe"></i></div>                    <div class="clearfix"></div>                    <div class="clearfix" style="height: 10px;"></div>                    <p class="content"></p>                    <div class="clearfix"></div>                    <div style="border-top: 1px solid #dcdcdc;">                        <span class="like"> Like</span>                        <span class="comment"> Comment</span>                        <span class="share"> Share</span>                    </div>                </div>            </div>        </div>    </div>    @endsection@section('scriptCode')    <script>        token= '{{ csrf_token() }}';        function init(){        }        $(document).ready(function(){            var nowDate=new Date();            $(document).on('click','#postButton',function(){                postToPage=$(".postToPage");                if(postToPage.length){                    postMessage=$("#postMessage");                    message=postMessage.val();                    if(message.length){                        FaceBook.login(function(response) {                            postToPage.each(function(){                                el=$(this);                                page_id=el.data('id');                                 if (response.authResponse) {                                     scheduleDate=el.find('.schedule').attr('date-time');                                     console.log(page_id);                                     console.log(message);                                     console.log(scheduleDate);                                     FaceBook.shareInPage('/'+page_id,message,scheduleDate,function(data){                                         post_id=data.id;                                         $.ajax({                                             type: "POST",                                             url: "{{ URL('addPost') }}",                                             data: {"page_id":page_id,"message":message,"post_id":post_id,_token:token},                                             success: function (msg) {                                             }                                         });                                         el.remove();                                     });                                     /*FaceBook.customRequest('/'+page_id,'GET',{"fields":"access_token"},function(d){                                         scheduleDate=el.find('.schedule').attr('date-time');                                         if(scheduleDate=='now'){                                             FaceBook.customRequest('/'+page_id+'/feed','POST',{"message": message,"access_token": d.access_token},function(data){                                                 console.log(data);                                                 post_id=data.id;                                                 $.ajax({                                                     type: "POST",                                                     url: "{{ URL('addPost') }}",                                                     data: {"page_id":page_id,"message":message,"post_id":post_id,_token:token},                                                     success: function (msg) {                                                     }                                                 });                                                 el.remove();                                             });                                         }else{                                             FaceBook.customRequest('/'+page_id+'/feed','POST',{"message": message,"access_token": d.access_token,"published":false,"scheduled_publish_time":scheduleDate},function(data){                                                 console.log(data);                                                 post_id=data.id;                                                 $.ajax({                                                     type: "POST",                                                     url: "{{ URL('addPost') }}",                                                     data: {"page_id":page_id,"message":message,"post_id":post_id,_token:token},                                                     success: function (msg) {                                                     }                                                 });                                                 el.remove();                                             });                                         }                                     });*/                                 }                             });                        });                        postMessage.val('');                        $("#clearPublisher").trigger('click')                        $("#errorMessage").html('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>Your Post Is Success Posted</div>')                    }                }            });            $(document).on('click','#clearPublisher',function(e){                e.preventDefault();                $("#postMessage").val('');                $("#postsInPages").html('');                $("#checkAllProfiles").prop('checked',false);                $("#postButton").html('Schedule').attr('disabled','disabled');                $(".userProfiles").prop('checked',false);                $("#countPost").html(0)                $("#facebookPost").addClass('hidden');                $("#emptyPost").removeClass('hidden');            });            $(document).on('click','#useProfile',function(){                html='';                $(".userProfiles:checked").each(function(){                    html+='<div class="col-lg-12 postToPage" data-id="'+$(this).val()+'"><img src="https://scontent.xx.fbcdn.net/v/t1.0-1/p50x50/20799907_131752677440834_5496398408492918250_n.jpg?oh=c4c9047b010223a4aa074cbe048d134d&oe=5A3F36EC" alt="Test_page"><span>Test_page</span><a href="" onclick="return false;" date-time="now" class="pull-right schedule">Now</a></div>';                });                $("#preview #facebookPost .title").html($(".userProfiles:checked:first").attr('data-name'));                $("#preview #facebookPost img").attr('src',$(".userProfiles:checked:first").attr('data-image'));                postButton=$("#postButton");                $("#postsInPages").html(html);                $(".bd-chose-page").modal('toggle');                if(html.length){                    $('.schedule').datetimepicker({                        onChangeDateTime:function(){                            nowDate=new Date();                        },                        onClose:function(dp,$input){                            //console.log(dp)                            if(dp.getTime()<=nowDate.getTime()){                                $input.html('Now')                                $input.attr('date-time','now');                            }else{                                $input.html(dp.getFullYear()+'-'+(dp.getMonth()+1)+'-'+dp.getDay()+' '+dp.getHours()+':'+dp.getMinutes())                                dateTime=Math.round(dp.getTime()/1000)+120                                //console.log(dateTime)                                $input.attr('date-time',dateTime);                            }                        },                        dayOfWeekStart : 1,                        lang:'en',                        disabledDates:[],//['1986/01/08','1986/01/09','1986/01/10'],                        startDate:	new Date()//'1986/01/08'                    });                    $("#emptyPost").addClass('hidden');                    $("#facebookPost").removeClass('hidden');                    $("#preview .content").html($("#postMessage").val());                    postButton.html('Publish');                    if($("#postMessage").val().length){                        postButton.removeAttr('disabled');                    }                }            });            $(document).on('keyup','#searchProfile',function(){                search=$(this).val();                $.ajax({                    type: "POST",                    url: "{{ URL('searchProfile') }}",                    data: {"search":search,_token:token},                    success: function (msg) {                        if(msg.success){                            $("#allProfiles").html(msg.html);                        }                    }                });            });            $(document).on('change','.userProfiles',function(){                checkBoxes=$("#checkAllProfiles");                if($(".userProfiles").length==$(".userProfiles:checked").length){                    checkBoxes.prop("checked",true);                }else{                    checkBoxes.prop("checked",false);                }            });            $(document).on('change','#checkAllProfiles',function(){                if($(this).is(':checked')){                    $(".userProfiles").prop('checked',true);                }else{                    $(".userProfiles").prop('checked',false);                }            });            $(document).on('keyup','#postMessage',function(){                countWords=$(this).val().length                $("#preview .content").html($(this).val());                if($("#postButton").html()=='Publish'){                    if(countWords){                        $("#postButton").removeAttr('disabled');                    }else{                        $("#postButton").attr('disabled','disabled');                    }                }               $("#countPost").html(countWords);            });            $(document).on('click','#socialFacebookAddProfile',function(){                data=[];                html='';                $(".socialFacebookCheckbox:checked").each(function(){                    id=$(this).val();                    type='facebook';                    name=$(this).attr('data-name');                    image_url=$(this).attr('data-image');                    data.push({"id":id,"name":name,"type":type,"image_url":image_url});                    html+='<div class="col-lg-12"><div class="checkbox"><label><input type="checkbox" class="userProfiles" data-name="'+name+'" data-image="'+image_url+'" value="'+id+'" id=""><img src="'+image_url+'" alt="Test_page"><span>'+name+'</span></label></div></div>';                });                $("#allProfiles").html(html);                $.ajax({                    type: "POST",                    url: "{{ URL('addNewProfile') }}",                    data: {data:JSON.stringify(data),_token:token},                    success: function (msg) {                       if(msg.success){                           $(".bd-create-new-post-lg").modal('toggle');                           $("#socialLoginBox").html('');                           $("#socialLogin").removeClass('hidden');                           $("#leftMenuCreatePost").attr('data-target','.bd-chose-page')                       }                    }                });            });            $(document).on('change','.socialFacebookCheckbox',function(){              if($(".socialFacebookCheckbox:checked").length){                  $("#socialFacebookAddProfile").removeAttr('disabled');              }else{                  $("#socialFacebookAddProfile").attr('disabled','disabled');              }            });            $(document).on('click','#connectSocialFacebook',function(e){                e.preventDefault();                allIDS=[];                $(".userProfiles").each(function(){allIDS.push($(this).val())});                FaceBook.login(function(response) {                    if (response.authResponse) {                        FaceBook.getUserDetails(function(user){                            FaceBook.getPagesList(function(data){                                html='';                                data.data.forEach(function(item){                                    console.log(item.id);                                    console.log(allIDS);                                    console.log($.inArray(item.id,allIDS));                                    if($.inArray('ADMINISTER',item.perms)!== -1){                                        html+='<div class="col-lg-12 '+(($.inArray(item.id,allIDS)===-1)?'':'hasAddPage')+'">'+(($.inArray(item.id,allIDS)===-1)?'':'<span style="color:red;margin-top: 10px;" class="pull-right">Profile already managed in this account.</span>')+'<div class="checkbox"><label><input '+(($.inArray(item.id,allIDS)===-1)?'':'disabled')+' type="checkbox" class="socialFacebookCheckbox " data-image="'+item.picture.data.url+'" data-name="'+item.name+'" value="'+item.id+'" id=""><img src="'+item.picture.data.url+'" alt="'+item.name+'"><span>'+item.name+'</span></label></div></div>';                                    }                                });                                html+='<div class="clearfix"></div>';                                html+='<div class="col-lg-12"><button id="socialFacebookAddProfile" disabled class="btn btn-primary pull-right">Add profiles</button></div>';                                $("#socialLogin").addClass('hidden');                                $("#socialLoginBox").html(html);                            });                        })                    }else{                        console.log('User cancelled login or did not fully authorize.');                    }                });            });        });    </script>@endsection